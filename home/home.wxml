<view class="page">
	<!-- <button bind:tap="createQrcode" style="margin-top: 40rpx;">aa</button> -->
	<view class="{{ data.user.deviceId&& data.user.state===0?'scroll':''}}">
		<control id="device-control" parent="{{data}}" bind:update="update" wx:if="{{page==='control'}}" />
		<setting parent="{{data}}" wx:else bind:update="update" />
	</view>
	<view class="flex-row justify-center group_9" wx:if="{{data.user.deviceId && data.user.state===0}}">
		<view class="flex-col justify-center items-center {{page==='control'?'active':''}}" bind:tap="switchTab" data-page="control">
			<image src="{{'/images/control'+(page==='control'?'-active':'')+'.png'}}" />
			<text>控制</text>
		</view>
		<view class="flex-col justify-center items-center {{page==='setting'?'active':''}}" bind:tap="switchTab" data-page="setting">
			<image src="{{'/images/setting'+(page==='setting'?'-active':'')+'.png'}}" />
			<text>设置</text>
		</view>
	</view>
</view>
<view class="qrcode">
	<canvas type="2d" style="width:{{width}}px;height:{{height}}px;" id="qrcodeTmp"></canvas>
	<canvas type="2d" style="width:{{width}}px;height:{{height*1.2}}px;" id="qrcode"></canvas>
</view>
<page-container duration="{{0}}" bind:afterleave="afterleave" show="{{true}}" wx:if="{{data.dialog}}">
	<view class="dialog">
		<view class="dialog-hd" wx:if="{{data.dialog.type==='mark'}}">设置备注</view>
		<view class="dialog-hd" wx:elif="{{data.dialog.type==='loading'}}">{{data.dialog.title}}</view>
		<view class="dialog-hd" wx:elif="{{data.dialog.type==='find'}}">查询设备</view>
		<view class="dialog-hd" wx:elif="{{data.dialog.type==='pair'}}">连接蓝牙</view>
		<view class="dialog-hd flex-row items-center justify-between" wx:elif="{{data.dialog.type==='help'}}">{{data.dialog.title}}
			<image src="/images/help.png" />
		</view>
		<view class="dialog-hd flex-row items-center" wx:elif="{{data.dialog.type==='pincode'}}">当前配对码 <text>{{data.dialog.pinCode}}</text></view>
		<view class="dialog-bd" wx:if="{{data.dialog.type==='find'}}">
			<view class="dialog-find">
				<view wx:if="{{!devices.length}}">正在查询设备...</view>
				<view wx:else="">
					<view class="device-item flex-row items-center" wx:for="{{devices}}" wx:for-item="item" wx:for-index="index" bind:tap="createBLEConnectionEvent" data-index="{{index}}" wx:key="index">
						<image src="/images/Vector.png" mode="" />
						<view class="flex-col">
							<text>{{item.name || item.localName || ""}}</text>
							<text style="font-size: 20rpx;">蓝牙MAC地址: {{item.deviceId}}</text>
						</view>
						<text class="prevDeviceId" wx:if="{{prevDeviceId===item.deviceId}}">上次连接</text>
					</view>
				</view>
			</view>
		</view>
		<view class="dialog-bd image" wx:elif="{{data.dialog.type==='image'}}">
			<image src="{{data.dialog.url}}" mode="widthFix" show-menu-by-longpress="{{true}}" />
		</view>
		<view class="dialog-bd" wx:elif="{{data.dialog.type==='help'}}">
			<view class="dialog-content">
				<rich-text nodes="{{data.dialog.content}}" />
			</view>
		</view>
		<view class="dialog-bd" wx:elif="{{data.dialog.type==='loading'}}">
			<view class="flex-row items-center justify-center" style="height:200rpx;">
				<image src="/images/loading.png" class="loading" style="width: 100rpx;height: 100rpx;" />
			</view>
		</view>
		<view class="dialog-bd" wx:elif="{{data.dialog.type==='pair'}}">
			<view class="dialog-input">
				<view>
					<input focus="{{data.dialog.type!=='help'}}" type="{{data.dialog.type==='mark'?'text':'number'}}" maxlength="{{data.dialog.type==='mark'?10:6}}" bindinput="setDialogInput" value="{{data.dialog.input}}" />
				</view>
			</view>
		</view>
		<view class="dialog-bd" wx:else>
			<view class="dialog-input">
				<text wx:if="{{data.dialog.type==='pincode'}}">新的配对码</text>
				<view>
					<!-- <view class="flex-row items-center justify-center" wx:if="{{data.dialog.type==='pincode'}}">
					<text wx:for="{{data.dialog.inputValue}}" wx:key="index" wx:for-item="item">{{item}}</text>
				</view> -->
					<input focus="{{data.dialog.type!=='help'}}" type="{{data.dialog.type==='mark'?'text':'number'}}" maxlength="{{data.dialog.type==='mark'?10:6}}" bindinput="setDialogInput" value="{{data.dialog.input}}" />
				</view>
			</view>
		</view>
		<view class="dialog-btn flex-row items-center justify-around">
			<view class="flex-row items-center justify-center" wx:if="{{data.dialog.type==='image'}}" bind:tap="save">保存</view>
			<view class="flex-row items-center justify-center" wx:else="" bind:tap="afterleave">取消</view>
			<view class="flex-row items-center justify-center" wx:if="{{data.dialog.type==='image'}}" bind:tap="shareQrcode">分享</view>
			<view class="flex-row items-center justify-center" wx:elif="{{data.dialog.type==='pincode'||data.dialog.type==='pair' || data.dialog.type==='mark'}}" bind:tap="sure">确认</view>
		</view>
	</view>
</page-container>